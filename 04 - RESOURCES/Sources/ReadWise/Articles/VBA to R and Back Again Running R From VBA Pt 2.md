---
Date: 2023-06-13
Author: Jimmy Briggs <jimmy.briggs@jimbrig.com>
Source: reader
Link: https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/
Tags:
  - "#Type/Highlight/Article"
Aliases:
  - "VBA to R and Back Again: Running R From VBA Pt 2"
  - "VBA to R and Back Again: Running R From VBA Pt 2"
---
# VBA to R and Back Again: Running R From VBA Pt 2

## Metadata
- Author: [[Steven P. Sanderson II, MPH]]
- Full Title: VBA to R and Back Again: Running R From VBA Pt 2
- Category: #Type/Highlight/Article
- URL: https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/

## Highlights
- First, let’s look at the Function called “Run_R_Script”. This function takes four arguments, where the first two are mandatory, and the last two are optional. ([View Highlight](https://read.readwise.io/read/01h06qmsmrz79wzg9878rp4vj4))
- • sRApplicationPath - This is the path to the R application that you want to use to run your script. It is a required argument, and you need to provide the full path to the Rscript.exe file on your machine. ([View Highlight](https://read.readwise.io/read/01h06qmvtme4jz9kk8atp52gtk))
- sRFilePath - This is the path to the R script file that you want to execute. It is also a required argument, and you need to provide the full path to your R script file. ([View Highlight](https://read.readwise.io/read/01h06qmxg7wxt5nxp5c7y18zpj))
- iStyle - This is an optional argument that specifies how the script will be executed. By default, it is set to 1, which means that the script will run in a minimized window. ([View Highlight](https://read.readwise.io/read/01h06qmzsb1qfmws1b1tmm5y00))
- bWaitTillComplete - This is another optional argument that specifies whether the function should wait until the script has finished running before returning control to the caller. By default, it is set to True, which means that the function will not return control until the script has completed execution. ([View Highlight](https://read.readwise.io/read/01h06qn1azcddt48namgtmjpj1))
- The first line inside the Function defines two variables: sPath and shell.
  • sPath - This variable will hold the path to the Rscript.exe file and the path to the R script file, which will be used later to run the script.
  • shell - This variable is used to create an instance of the WScript.Shell object.
  Next, we wrap the R path with double quotations to avoid any issues with spaces in the path. ([View Highlight](https://read.readwise.io/read/01h06qn5wcsac7fv7e4vpz7d13))
- Then, instead of using the “shell.Run” function, the code uses the “shell.Exec” function to execute the R script. This function returns an object that has a “StdOut” property, which contains the output of the script.
  The output is then read using the “ReadAll” method, and the resulting string is split into an array using the “Split” function. The array is then iterated using a “For” loop, and each element of the array is written to Column A, starting at cell A1.
  Finally, the Function returns an Integer value, which is the result of the “shell.Run” function.
  The Subroutine called “Demo” just demonstrates how to use the “Run_R_Script” function by calling it with the appropriate parameters. ([View Highlight](https://read.readwise.io/read/01h06qnbm2v9jfc5cedp9pwt8f))
- Here is the R Script ([View Highlight](https://read.readwise.io/read/01h06qnfg0wy45rkhq6dcppvvr))
- data.frame( [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-2)x = 1:10, [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-3)y = rnorm(10) [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-4)) [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-5)[](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-6)list( [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-7)data.frame( [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-8)x = 1:10, [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-9)y = rnorm(10) [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-10)), [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-11)data.frame( [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-12)x = 1:10, [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-13)y = rnorm(10) [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-14)) [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb1-15)) ([View Highlight](https://read.readwise.io/read/01h06qnj14j3q77dw2z0z6k11q))
- Full VBA ([View Highlight](https://read.readwise.io/read/01h06qnphxsyne5d95n3c6vd7e))
- Function Run_R_Script(sRApplicationPath As String, _ [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-2)sRFilePath As String, _ [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-3)Optional iStyle As Integer = 1, _ [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-4)Optional bWaitTillComplete As Boolean = True) As Integer [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-5)[](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-6)Dim sPath As String [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-7)Dim shell As Object [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-8)[](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-9)'Define shell object [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-10)Set shell = VBA.CreateObject("WScript.Shell") [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-11)[](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-12)'Wrap the R path with double quotations [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-13)sPath = """" & sRApplicationPath & """" [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-14)sPath = sPath & " " [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-15)sPath = sPath & sRFilePath [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-16)[](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-17)'Delete Coumn A [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-18)Columns("A").Delete [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-19)[](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-20)'Get Result [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-21)result = shell.Exec(sPath).StdOut.ReadAll [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-22)result = Split(result, vbCrLf) [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-23)For i = 0 To UBound(result) [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-24)ActiveSheet.Range("A1").Offset(i, 0).Value = result(i) [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-25)Next i [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-26)[](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-27)End Function [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-28)[](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-29)Sub Demo() [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-30)Dim iEerrorCode As Integer [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-31)iEerrorCode = Run_R_Script("C:\Program Files\R\R-4.1.2\bin\x64\Rscript.exe", "C:\Users\ssanders\Desktop\test.R") [](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-10/#cb2-32)End Sub ([View Highlight](https://read.readwise.io/read/01h06qnvm5bah3phmsm4hj7m8c))
- Reference
  [https://stackoverflow.com/a/54816881](https://stackoverflow.com/a/54816881) ([View Highlight](https://read.readwise.io/read/01h06qnza9svbfjw17nwnknxqx))
